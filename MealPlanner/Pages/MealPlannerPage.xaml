<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MealPlanner.Pages.MealPlannerPage"
             Title="Weekly Meal Plan">

	<ScrollView>
		<VerticalStackLayout Padding="15" Spacing="15">

			<!-- Header -->
			<HorizontalStackLayout Spacing="10" Margin="0,10,0,15">
				<Label Text="ðŸ“… This Week's Meals"
                       FontSize="24"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       HorizontalOptions="Start" />

				<ActivityIndicator x:Name="LoadingIndicator"
                                  IsRunning="False"
                                  IsVisible="False"
                                  Color="#2196F3"
                                  HorizontalOptions="End" />
			</HorizontalStackLayout>

			<!-- Recipe to Add Section (visible when recipe passed from detail page) -->
			<Border x:Name="RecipeToAddSection"
                    IsVisible="False"
                    BackgroundColor="#E3F2FD"
                    Stroke="#2196F3"
                    StrokeThickness="2"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
				<VerticalStackLayout Spacing="10">
					<Label Text="ðŸ“Œ Add this recipe to your meal plan:"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#2196F3" />
					<Label x:Name="RecipeToAddLabel"
                           FontSize="18"
                           FontAttributes="Bold" />
					<Label Text="Tap on any meal slot below to add it there"
                           FontSize="14"
                           TextColor="Gray" />
				</VerticalStackLayout>
			</Border>

			<!-- Days of the Week -->
			<CollectionView x:Name="DaysCollectionView">
				<CollectionView.ItemTemplate>
					<DataTemplate>
						<Border Margin="0,0,0,15"
                                Padding="15"
                                Stroke="LightGray"
                                StrokeThickness="1"
                                BackgroundColor="White"
                                StrokeShape="RoundRectangle 12">
							<Border.Shadow>
								<Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2" />
							</Border.Shadow>

							<VerticalStackLayout Spacing="12">

								<!-- Day Name -->
								<Label Text="{Binding Day}"
                                       FontSize="20"
                                       FontAttributes="Bold"
                                       TextColor="#2196F3" />

								<!-- Breakfast: show Breakfast.Name (TargetNullValue when no recipe) -->
								<Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
									<Label Grid.Column="0" Text="ðŸŒ…" FontSize="20" VerticalOptions="Center" />
									<Label Grid.Column="1"
                                           Text="{Binding Breakfast.Name, TargetNullValue='Tap to add breakfast'}"
                                           FontSize="15"
                                           VerticalOptions="Center"
                                           TextColor="{Binding Breakfast, Converter={StaticResource NullToColorConverter}}" />
									<Button Grid.Column="2"
                                            Text="+"
                                            Clicked="OnBreakfastClicked"
                                            CommandParameter="{Binding Day}"
                                            BackgroundColor="#4CAF50"
                                            TextColor="White"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            CornerRadius="20"
                                            Padding="0"
                                            FontSize="20"
                                            FontAttributes="Bold" />
								</Grid>

								<!-- Lunch -->
								<Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
									<Label Grid.Column="0" Text="â˜€ï¸" FontSize="20" VerticalOptions="Center" />
									<Label Grid.Column="1"
                                           Text="{Binding Lunch.Name, TargetNullValue='Tap to add lunch'}"
                                           FontSize="15"
                                           VerticalOptions="Center"
                                           TextColor="Black" />
									<Button Grid.Column="2"
                                            Text="+"
                                            Clicked="OnLunchClicked"
                                            CommandParameter="{Binding Day}"
                                            BackgroundColor="#4CAF50"
                                            TextColor="White"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            CornerRadius="20"
                                            Padding="0"
                                            FontSize="20"
                                            FontAttributes="Bold" />
								</Grid>

								<!-- Dinner -->
								<Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
									<Label Grid.Column="0" Text="ðŸŒ™" FontSize="20" VerticalOptions="Center" />
									<Label Grid.Column="1"
                                           Text="{Binding Dinner.Name, TargetNullValue='Tap to add dinner'}"
                                           FontSize="15"
                                           VerticalOptions="Center"
                                           TextColor="{Binding Dinner, Converter={StaticResource NullToColorConverter}}" />
									<Button Grid.Column="2"
                                            Text="+"
                                            Clicked="OnDinnerClicked"
                                            CommandParameter="{Binding Day}"
                                            BackgroundColor="#4CAF50"
                                            TextColor="White"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            CornerRadius="20"
                                            Padding="0"
                                            FontSize="20"
                                            FontAttributes="Bold" />
								</Grid>

							</VerticalStackLayout>
						</Border>
					</DataTemplate>
				</CollectionView.ItemTemplate>
			</CollectionView>

			<!-- Generate Shopping List Button -->
			<Border BackgroundColor="#FF9800"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 12"
                    Padding="0"
                    Margin="0,10,0,20">
				<Border.Shadow>
					<Shadow Brush="Black" Opacity="0.2" Radius="10" Offset="0,4" />
				</Border.Shadow>
				<Button Text="ðŸ›’ Generate Shopping List"
                        Clicked="OnGenerateShoppingListClicked"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="18"
                        FontAttributes="Bold"
                        HeightRequest="60" />
			</Border>

		</VerticalStackLayout>
	</ScrollView>

</ContentPage>